# 一、tomcat搭建

## 1.1 http协议(超文本传输协议HyperText Transfer Protocol)，它是基于TCP协议的应用层传输协议，简单来说就是客户端和服务端进行数据传输的一种规则。

>**注意**：客户端与服务器的角色不是固定的，一端充当客户端，也可能在某次请求中充当服务器。这取决与请求的发起端。HTTP协议属于应用层，建立在传输层协议TCP之上。客户端通过与服务器建立TCP连接，之后发送HTTP请求与接收HTTP响应都是通过访问Socket接口来调用TCP协议实现。

---

`HTTP` 是一种**无状态** (stateless) 协议, `HTTP`协议本身不会对发送过的请求和相应的通信状态进行持久化处理。这样做的目的是为了保持HTTP协议的简单性，从而能够快速处理大量的事务, 提高效率。

然而，在许多应用场景中，我们需要保持用户登录的状态或记录用户购物车中的商品。由于`HTTP`是无状态协议，所以必须引入一些技术来记录管理状态，例如`Cookie`。

## HTTP的五大特点

1. 支持**客户/服务器**模式。
2. **简单快速**：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有`GET`、`HEAD`、`POST`。每种方法规定了客户与服务器联系的类型不同。由于`HTTP`协议简单，使得`HTTP`服务器的程序规模小，因而通信速度很快。
3. **灵活**：HTTP允许传输任意类型的数据对象。正在传输的类型由`Content-Type`加以标记。
4. **无连接**：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。早期这么做的原因是请求资源少，追求快。后来通过`Connection: Keep-Alive`实现长连接
5. **无状态**：`HTTP`协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

## 非持久连接和持久连接

在实际的应用中，客户端往往会发出一系列请求，接着服务器端对每个请求进行响应。对于这些请求|响应，如果每次都经过一个单独的TCP连接发送，称为**非持久连接**。反之，如果每次都经过相同的TCP连接进行发送，称为**持久连接**。

![img](https://pic4.zhimg.com/80/v2-1fdf96c5bd825e2d54b932eebb880de7_1440w.webp)



非持久连接在每次请求|响应之后都要断开连接，下次再建立新的TCP连接，这样就造成了大量的通信开销。例如前面提到的往返时间`(RTT)` 就是在建立TCP连接的过程中的代价。

非持久连接给服务器带来了沉重的负担，每台服务器可能同时面对数以百计甚至更多的请求。持久连接就是为了解决这些问题，其特点是一直保持TCP连接状态，直到遇到明确的中断要求之后再中断连接。持久连接减少了通信开销，节省了通信量。

## HTTP和HTTPS

## HTTP的不足

- 通信使用明文(不加密),内容可能会被窃听
- 不验证通信方的身份,因此有可能遭遇伪装
- 无法证明报文的完整性,所以有可能已遭篡改

## HTTPS介绍

`HTTP` 协议中没有加密机制,但可以通 过和 `SSL`(Secure Socket Layer, **安全套接层** )或 `TLS`(Transport Layer Security, **安全层传输协议**)的组合使用,加密 `HTTP` 的通信内容。属于通信加密，即在整个通信线路中加密。

```text
HTTP + 加密 + 认证 + 完整性保护 = HTTPS（HTTP Secure ）
```

![img](https://pic1.zhimg.com/80/v2-6afa8562333419e7aac98f8dc4b13340_1440w.webp)

`HTTPS` 采用**共享密钥加密**（对称）和**公开密钥加密**（非对称）两者并用的**混合**加密机制。若密钥能够实现安全交换,那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比,其处理速度要慢。

> 所以应充分利用两者各自的优势, 将多种方法组合起来用于通信。 在**交换密钥**阶段使用**公开密钥加密**方式,之后的建立通信**交换报文**阶段 则使用**共享密钥加密**方式。



![img](https://pic3.zhimg.com/80/v2-9af3ae935bd8bf85261d3469a72f1a62_1440w.webp)



`HTTPS`握手过程的简单描述如下：

![img](https://pic3.zhimg.com/80/v2-a546b518ccc741e8705f1e00afe4a33a_1440w.webp)



1. 浏览器将自己支持的一套加密规则发送给网站。
   `服务器获得浏览器公钥`
2. 网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。 `浏览器获得服务器公钥`
3. 获得网站证书之后浏览器要做以下工作：
   (a). 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。
   (b). 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码（接下来通信的密钥），并用证书中提供的公钥加密（共享密钥加密）。
   (c) 使用约定好的HASH计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。 `浏览器验证 -> 随机密码 服务器的公钥加密 -> 通信的密钥 通信的密钥 -> 服务器`
4. 网站接收浏览器发来的数据之后要做以下的操作：
   (a). 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。
   (b). 使用密码加密一段握手消息，发送给浏览器。
   `服务器用自己的私钥解出随机密码 -> 用密码解密握手消息（共享密钥通信）-> 验证HASH与浏览器是否一致（验证浏览器）`
   HTTPS的不足
5. 加密解密过程复杂，导致访问速度慢
6. 加密需要认向证机构付费
7. 整个页面的请求都要使用HTTPS

## 1.2 http请求/响应的步骤

### 客户端连接到Web服务器

一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。
例如:http://www.baidu.com。

###  发送HTTP请求

通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、
空行和请求数据4部分组成。

###  服务器接受请求并返回HTTP响应

Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由
状态行、响应头部、空行和响应数据4部分组成。

###  释放TCP连接

在HTTP/1.0中默认使用短连接。也就是说，客户端和服务器每进行一次HTTP操作，就建立一次连接，
任务结束就中断连接。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源
（如JavaScript文件、图像文件、CSS文件等），每遇到这样一个Web资源，浏览器就会重新建立一个
HTTP会话。
而从HTTP/1.1起，默认使用长连接，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这
行代码：

```
Connection:keep-alive
```

在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不
会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。Keep-Alive不会永久保持
连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。实现长连接需要客
户端和服务端都支持长连接。
HTTP协议的长连接和短连接，实质上是TCP协议的长连接和短连接。

### 客户端浏览器解析HTML内容

客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告
知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法
对其进行格式化，并在浏览器窗口中显示。
例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：

1. 浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2. 解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3. 浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握

手的第三个报文的数据发送给服务器;

4. 服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5. 浏览器将该 html 文本并显示内容;

## 1.3 http请求方法

HTTP协议的方法有： *`GET`： 请求**获取**Request-URI所标识的资源* `POST`： 在Request-URI所标识的资源后**增加**新的数据 *`HEAD`： 请求获取由Request-URI所标识的资源的**响应消息报头*** `PUT`： 请求服务器**存储或修改**一个资源，并用Request-URI作为其标识 *`DELETE`： 请求服务器**删除**Request-URI所标识的资源* `TRACE`： 请求服务器回送收到的请求信息，主要用于**测试或诊断** *`CONNECT`： 保留将来使用* `OPTIONS`： 请求查询服务器的性能，或者查询与资源相关的选项和需求

### GET

向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作
中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。

### HEAD

与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好
处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信
息或称元数据）。

### POST

向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文
中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。

### PUT

向指定资源位置上传其最新内容。

### DELETE

请求服务器删除Request-URI所标识的资源。

### TRACE

回显服务器收到的请求，主要用于测试或诊断。

### OPTIONS

这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'*'来代替资源名称，向Web服务器发送
OPTIONS请求，可以测试服务器功能是否正常运作。

### CONNECT

## 1.4 两种开发模型

### C/S

又称Client/Server或客户/服务器模式。服务器通常采用高性能的PC、工作站或小型机，客户端
需要安装专用的客户端软件。如QQ,微信等软件

### B/S

### 是Brower/Server的缩写，客户机上只要安装一个浏览器（Browser）。Browser/Server是建立在

广域网的基础上的.

### CS和BS结构各自的优、缺点

1) C/S的优点是能充分发挥客户端PC的处理能力，很多工作可以在客户端处理后再提交给服务器。对应

的优点就是客户端响应速度快。
缺点主要有以下几个

1) 客户端需要安装专用的客户端软件。首先涉及到安装的工作量，其次任何一台电脑出问题，如病毒、

硬件损坏，都需要进行安装或维护。特别是有很多分部或专卖店的情况，不是工作量的问题，而是路程
的问题。还有，系统软件升级时，每一台客户机需要重新安装，其维护和升级成本非常高。

2) B/S最大的优点就是可以在任何地方进行操作而不用安装任何专门的软件。只要有一台能上网的电脑

就能使用，客户端零维护。系统的扩展非常容易，只要能上网，就可以使用了。甚至可以在线申请，通
过公司内部的安全认证（如CA证书）后，不需要人的参与，系统可以自动分配给用户一个账号进入系
统。

## 1.5 web服务器的分类

Web服务器是运行及发布Web应用的容器，只有将开发的Web项目放置到该容器中，才能使网络中的所
有用户通过浏览器进行访问。开发Java Web应用所采用的服务器主要是与JSP/Servlet兼容的Web服务
器，比较常用的有Tomcat、Resin、JBoss、WebSphere 和 WebLogic 等

### Tomcat 服务器

目前最为流行的Tomcat服务器是Apache-Jarkarta开源项目中的一个子项目，是一个小型、轻量级
的支持JSP和Servlet 技术的Web服务器，也是初学者学习开发JSP应用的首选

### Resin 服务器

Resin是Caucho公司的产品，是一个非常流行的支持Servlet和JSP的服务器，速度非常快。Resin本
身包含了一个支持HTML的Web服务器，这使它不仅可以显示动态内容，而且显示静态内容的能力也毫
不逊色，因此许多网站都是使用Resin服务器构建

### JBoss服务器

JBoss是一个种遵从JavaEE规范的、开放源代码的、纯Java的EJB服务器，对于J2EE有很好的支持。
JBoss采用JML API实现软件模块的集成与管理，其核心服务又是提供EJB服务器，不包含Servlet和JSP的
Web容器，不过它可以和Tomcat完美结合

### WebSphere 服务器

WebSphere是IBM公司的产品，可进一步细分为 WebSphere Performance Pack、Cache
Manager 和WebSphere Application Server等系列，其中WebSphere Application Server 是基于Java
的应用环境，可以运行于 Sun Solaris、Windows NT 等多种操作系统平台，用于建立、部署和管理
Internet和Intranet Web应用程序。

### WebLogic 服务器

WebLogic 是BEA公司的产品（现在已经被Oracle收购），可进一步细分为 WebLogic Server、
WebLogic Enterprise 和 WebLogic Portal 等系列，其中 WebLogic Server 的功能特别强大。
WebLogic 支持企业级的、多层次的和完全分布式的Web应用，并且服务器的配置简单、界面友好。对
于那些正在寻求能够提供Java平台所拥有的一切应用服务器的用户来说，WebLogic是一个十分理想的选
择

## 1.6 Tomcat目录


1、bin：该目录下存放的是二进制可执行文件，如果是安装版，那么这个目录下会有两个exe文件：
tomcat9.exe、tomcat9w.exe，前者是在控制台下启动Tomcat，后者是弹出UGI窗口启动Tomcat；如
果是解压版，那么会有startup.bat和shutdown.bat文件，startup.bat用来启动Tomcat，但需要JDK的
配置，shutdown.bat用来停止Tomcat；
2、conf：这是一个非常非常重要的目录，这个目录下有四个最为重要的文件：
server.xml：配置整个服务器信息。例如修改端口号，添加虚拟主机等；
tomcat-users.xml：存储tomcat用户的文件，这里保存的是tomcat的用户名及密码，以及用户的角色
信息。可以按着该文件中的注释信息添加tomcat用户，然后就可以在Tomcat主页中进入Tomcat
Manager页面了；
web.xml：部署描述符文件，这个文件中注册了很多MIME类型，即文档类型。这些MIME类型是客户端
与服务器之间说明文档类型的，如用户请求一个html网页，那么服务器还会告诉客户端浏览器响应的文
档是text/html类型的，这就是一个MIME类型。客户端浏览器通过这个MIME类型就知道如何处理它了。
当然是在浏览器中显示这个html文件了。但如果服务器响应的是一个exe文件，那么浏览器就不可能显
示它，而是应该弹出下载窗口才对。MIME就是用来说明文档的内容是什么类型的！
context.xml：对所有应用的统一配置，通常我们不会去配置它。
3、lib：Tomcat的类库，里面是一大堆jar文件。如果需要添加Tomcat依赖的jar文件，可以把它放到这
个目录中，当然也可以把应用依赖的jar文件放到这个目录中，这个目录中的jar所有项目都可以共享之，
但这样你的应用放到其他Tomcat下时就不能再共享这个目录下的Jar包了，所以建议只把Tomcat需要的
Jar包放到这个目录下；
4、logs：这个目录中都是日志文件，记录了Tomcat启动和关闭的信息，如果启动Tomcat时有错误，那
么异常也会记录在日志文件中。
5、temp：存放Tomcat的临时文件，这个目录下的东西可以在停止Tomcat后删除！
6、webapps：存放web项目的目录，其中每个文件夹都是一个项目；如果这个目录下已经存在了目
录，那么都是tomcat自带的项目。其中ROOT是一个特殊的项目，在地址栏中没有给出项目目录时，对
应的就是ROOT项目。
http://localhost:8080/examples，进入示例项目。其中examples就是项目名，即文件夹的名字。
7、work：运行时生成的文件，最终运行的文件都在这里。通过webapps中的项目生成的！可以把这个
目录下的内容删除，再次运行时会生再次生成work目录。当客户端用户访问一个JSP文件时，Tomcat会
通过JSP生成Java文件，然后再编译Java文件生成class文件，生成的java和class文件都会存放到这个目录
下。
8、LICENSE：许可证。
9、NOTICE：说明文件。
通过url访问服务器:
url:http://服务器的ip地址:端口号/项目名/被访问的页面
示例:http://localhost:8080/test0918
不建议放在中文路径下!
tomcat安装需要配置JAVA_HOME环境变量

注: (1)启动tomcat后,tomcat会加载部署在服务器端的所有项目
(2) 浏览器访问的页面是服务器端的页面,基本上服务器的项目和工作空间的项目要保持一致

## 1.7创建javaweb项目

## 1.8修改端口号

修改配置文件:/conf/server.xml

```
<Connector port="8888" protocol="HTTP/1.1" connectionTimeout="20000"
redirectPort="8443" />
```

如果将端口号改成80,则访问项目时的请求路径就可以省略端口号。

## 1.9tomcat如何管理项目

给tomcat增加管理员信息:
配置conf/tomcat-users.xml

```
<tomcat-users>
<role rolename="manager-gui"/>
<user username="tomcat" password="tomcat" roles="manager-gui"/>
</tomcat-users>
```

注意:tomcat启动的时候会加载webapps下的所有项目